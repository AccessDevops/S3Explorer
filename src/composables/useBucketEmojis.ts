import { ref } from 'vue'

const STORAGE_KEY = 'bucket-emojis'
export const DEFAULT_EMOJI = 'ğŸ—„ï¸'

export const BUCKET_EMOJIS = [
  // Storage & Files
  'ğŸ—„ï¸', 'ğŸ“¦', 'ğŸ“', 'ğŸ“‚', 'ğŸ—ƒï¸',
  'ğŸ’¾', 'ğŸ’¿', 'ğŸ“€', 'ğŸ—‚ï¸', 'ğŸ“‹',
  'ğŸ—³ï¸', 'ğŸ“¥', 'ğŸ“¤', 'ğŸ§³', 'ğŸ’',
  // Data & Cloud
  'â˜ï¸', 'ğŸŒ', 'ğŸ”’', 'ğŸ”“', 'ğŸ›¡ï¸',
  'ğŸ”‘', 'ğŸ“Š', 'ğŸ“ˆ', 'ğŸ“‰', 'ğŸ—‘ï¸',
  'â™»ï¸', 'ğŸ”—', 'ğŸ§®', 'ğŸ”', 'ğŸ”',
  // Media & Images
  'ğŸ–¼ï¸', 'ğŸ¬', 'ğŸµ', 'ğŸ“·', 'ğŸ¥',
  'ğŸ“¹', 'ğŸ¤', 'ğŸ“»', 'ğŸ“º', 'ğŸ®',
  'ğŸ¨', 'ğŸ­', 'ğŸª', 'ğŸ§', 'ğŸ¹',
  'ğŸ¸', 'ğŸº', 'ğŸ»', 'ğŸ¥', 'ğŸ“¸',
  // Documents & Writing
  'ğŸ“„', 'ğŸ“ƒ', 'ğŸ“‘', 'ğŸ“°', 'ğŸ“',
  'âœï¸', 'ğŸ“–', 'ğŸ“š', 'ğŸ·ï¸', 'ğŸ”–',
  'ğŸ““', 'ğŸ“’', 'ğŸ“•', 'ğŸ“—', 'ğŸ“˜',
  'ğŸ“™', 'ğŸ“”', 'ğŸ“œ', 'ğŸ“°', 'ğŸ—ï¸',
  // Status & Indicators
  'â­', 'ğŸŒŸ', 'ğŸ’«', 'âœ¨', 'ğŸ”¥',
  'âš¡', 'ğŸ’¡', 'ğŸš€', 'ğŸ¯', 'ğŸ†',
  'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ…', 'ğŸ–ï¸',
  'âœ…', 'âŒ', 'âš ï¸', 'ğŸš«', 'ğŸ’¯',
  // Hearts & Colors
  'â¤ï¸', 'ğŸ§¡', 'ğŸ’›', 'ğŸ’š', 'ğŸ’™',
  'ğŸ’œ', 'ğŸ–¤', 'ğŸ¤', 'ğŸ¤', 'ğŸ’—',
  'ğŸ’–', 'ğŸ’', 'ğŸ’”', 'â£ï¸', 'ğŸ’•',
  // Tech & Tools
  'ğŸ–¥ï¸', 'ğŸ’»', 'âŒ¨ï¸', 'ğŸ–±ï¸', 'ğŸ”§',
  'âš™ï¸', 'ğŸ”©', 'ğŸ“¡', 'ğŸ›°ï¸', 'ğŸ¤–',
  'ğŸ”Œ', 'ğŸ”‹', 'ğŸ’', 'ğŸ§²', 'ğŸ”¬',
  'ğŸ”­', 'ğŸ“±', 'ğŸ“²', 'â˜ï¸', 'ğŸ“Ÿ',
  // Nature & Weather
  'ğŸŒ', 'ğŸŒ', 'ğŸŒ', 'ğŸŒ•', 'ğŸŒ™',
  'â­', 'ğŸŒˆ', 'ğŸŒŠ', 'ğŸ”†', 'â„ï¸',
  'ğŸŒ¸', 'ğŸŒº', 'ğŸŒ»', 'ğŸŒ¹', 'ğŸŒ´',
  'ğŸŒ²', 'ğŸ€', 'ğŸ', 'ğŸ‚', 'ğŸŒ¿',
  // Animals
  'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°',
  'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¦',
  'ğŸ¯', 'ğŸ®', 'ğŸ·', 'ğŸ¸', 'ğŸµ',
  'ğŸ”', 'ğŸ§', 'ğŸ¦', 'ğŸ¦…', 'ğŸ¦‰',
  'ğŸ¦‹', 'ğŸ', 'ğŸ', 'ğŸ¢', 'ğŸ¬',
  'ğŸ¦ˆ', 'ğŸ³', 'ğŸ™', 'ğŸ¦‘', 'ğŸ¦€',
  // Food & Drinks
  'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸ‡', 'ğŸ“',
  'ğŸ’', 'ğŸ‘', 'ğŸŒ', 'ğŸ‰', 'ğŸ',
  'ğŸ¥‘', 'ğŸ¥•', 'ğŸŒ½', 'ğŸ•', 'ğŸ”',
  'ğŸŸ', 'ğŸŒ®', 'ğŸœ', 'ğŸ£', 'ğŸ©',
  'ğŸª', 'ğŸ‚', 'ğŸ°', 'â˜•', 'ğŸµ',
  // Transport & Travel
  'ğŸš—', 'ğŸš•', 'ğŸšŒ', 'ğŸš', 'ğŸï¸',
  'ğŸš“', 'ğŸš‘', 'ğŸš’', 'âœˆï¸', 'ğŸš€',
  'ğŸ›¸', 'ğŸš', 'â›µ', 'ğŸš¢', 'ğŸ›³ï¸',
  'ğŸš‚', 'ğŸšƒ', 'ğŸš„', 'ğŸš…', 'ğŸš†',
  // Buildings & Places
  'ğŸ ', 'ğŸ¡', 'ğŸ¢', 'ğŸ£', 'ğŸ¤',
  'ğŸ¥', 'ğŸ¦', 'ğŸ¨', 'ğŸ©', 'ğŸª',
  'ğŸ«', 'ğŸ¬', 'ğŸ­', 'ğŸ¯', 'ğŸ°',
  'â›ª', 'ğŸ•Œ', 'ğŸ›•', 'â›©ï¸', 'ğŸ—¼',
  // Symbols & Shapes
  'ğŸ”´', 'ğŸŸ ', 'ğŸŸ¡', 'ğŸŸ¢', 'ğŸ”µ',
  'ğŸŸ£', 'ğŸŸ¤', 'âš«', 'âšª', 'ğŸ”¶',
  'ğŸ”·', 'ğŸ”¸', 'ğŸ”¹', 'ğŸ”º', 'ğŸ”»',
  'ğŸ’ ', 'ğŸ”˜', 'ğŸ”³', 'ğŸ”²', 'â¬›',
  'â¬œ', 'â—¼ï¸', 'â—»ï¸', 'â—¾', 'â—½',
  'â–ªï¸', 'â–«ï¸', 'ğŸŸ¥', 'ğŸŸ§', 'ğŸŸ¨',
  'ğŸŸ©', 'ğŸŸ¦', 'ğŸŸª', 'ğŸŸ«', 'â­•',
  'â—', 'â“', 'â•', 'â”', 'â€¼ï¸',
  'â‰ï¸', 'ğŸ’²', 'ğŸ’±', 'Â©ï¸', 'Â®ï¸',
  'â„¢ï¸', 'ğŸ”°', 'âšœï¸', 'ğŸ”±', 'ã€½ï¸',
  'âœ³ï¸', 'âœ´ï¸', 'â‡ï¸', 'ğŸ”¯', 'â™ˆ',
  'â™‰', 'â™Š', 'â™‹', 'â™Œ', 'â™',
  'â™', 'â™', 'â™', 'â™‘', 'â™’',
  'â™“', 'â›', 'ğŸ”€', 'ğŸ”', 'ğŸ”‚',
  'â–¶ï¸', 'â©', 'â­ï¸', 'â¯ï¸', 'â—€ï¸',
  'âª', 'â®ï¸', 'ğŸ”¼', 'â«', 'ğŸ”½',
  'â¬', 'â¸ï¸', 'â¹ï¸', 'âºï¸', 'âï¸',
  'ğŸ¦', 'ğŸ”…', 'ğŸ”†', 'ğŸ“¶', 'ğŸ“³',
  'ğŸ“´', 'â™€ï¸', 'â™‚ï¸', 'âš§ï¸', 'âœ–ï¸',
  'â•', 'â–', 'â—', 'ğŸŸ°', 'â™¾ï¸',
  'â€¼ï¸', 'â‰ï¸', 'â“', 'â”', 'â•',
  'â—', 'ã€°ï¸', 'ğŸ’¹', 'â™ ï¸', 'â™£ï¸',
  'â™¥ï¸', 'â™¦ï¸', 'ğŸƒ', 'ğŸ´', 'ğŸ€„',
  // Flags & Objects
  'ğŸ', 'ğŸš©', 'ğŸŒ', 'ğŸ´', 'ğŸ³ï¸',
  'ğŸ³ï¸â€ğŸŒˆ', 'ğŸ´â€â˜ ï¸', 'ğŸ€', 'ğŸ', 'ğŸˆ',
  'ğŸ‰', 'ğŸŠ', 'ğŸ‹', 'ğŸ', 'ğŸ',
  'ğŸ', 'ğŸ', 'ğŸ§§', 'ğŸª…', 'ğŸª†',
  'ğŸ”®', 'ğŸ§¿', 'ğŸª¬', 'ğŸ•¹ï¸', 'ğŸ§¸',
  'ğŸª€', 'ğŸª', 'ğŸª©', 'ğŸª„', 'ğŸƒ',
  'ğŸ„', 'ğŸ†', 'ğŸ‡', 'ğŸ§¨', 'ğŸ‘',
  // Objects - Household
  'ğŸ›‹ï¸', 'ğŸª‘', 'ğŸšª', 'ğŸª', 'ğŸªŸ',
  'ğŸ›ï¸', 'ğŸ›Œ', 'ğŸ§¸', 'ğŸ–¼ï¸', 'ğŸª´',
  'ğŸ›’', 'ğŸ§º', 'ğŸ§¹', 'ğŸ§»', 'ğŸª ',
  'ğŸ§¼', 'ğŸª¥', 'ğŸ§½', 'ğŸ§´', 'ğŸ›ï¸',
  'ğŸ”‘', 'ğŸ—ï¸', 'ğŸš¿', 'ğŸ›', 'ğŸª¤',
  'ğŸª’', 'ğŸ§·', 'ğŸ§²', 'ğŸªœ', 'ğŸ§°',
  // Objects - Tools & Hardware
  'ğŸ”§', 'ğŸª›', 'ğŸ”©', 'âš™ï¸', 'ğŸ—œï¸',
  'âš–ï¸', 'ğŸ¦¯', 'ğŸ”—', 'â›“ï¸', 'ğŸª',
  'ğŸ§°', 'ğŸ§²', 'ğŸª“', 'â›ï¸', 'âš’ï¸',
  'ğŸ› ï¸', 'ğŸ—¡ï¸', 'âš”ï¸', 'ğŸ”ª', 'ğŸ—¡ï¸',
  'ğŸ¹', 'ğŸ›¡ï¸', 'ğŸªš', 'ğŸ”¨', 'ğŸªƒ',
  // Objects - Office & School
  'ğŸ“Œ', 'ğŸ“', 'ğŸ–‡ï¸', 'ğŸ“', 'ğŸ–Šï¸',
  'ğŸ–‹ï¸', 'âœ’ï¸', 'ğŸ“', 'ğŸ“', 'âœ‚ï¸',
  'ğŸ—ƒï¸', 'ğŸ—„ï¸', 'ğŸ—‘ï¸', 'ğŸ”', 'ğŸ”',
  'ğŸ”’', 'ğŸ”“', 'ğŸ–Œï¸', 'ğŸ–ï¸', 'ğŸ“¦',
  'ğŸ“«', 'ğŸ“ª', 'ğŸ“¬', 'ğŸ“­', 'ğŸ“®',
  'ğŸ—³ï¸', 'âœ‰ï¸', 'ğŸ“§', 'ğŸ“¨', 'ğŸ“©',
  'ğŸ“¤', 'ğŸ“¥', 'ğŸ·ï¸', 'ğŸ’°', 'ğŸª™',
  'ğŸ’´', 'ğŸ’µ', 'ğŸ’¶', 'ğŸ’·', 'ğŸ’¸',
  'ğŸ’³', 'ğŸ§¾', 'ğŸ’¹', 'ğŸ”–', 'ğŸ“¿',
  // Objects - Light & Sound
  'ğŸ”¦', 'ğŸ®', 'ğŸª”', 'ğŸ•¯ï¸', 'ğŸ’¡',
  'ğŸ”Œ', 'ğŸª«', 'ğŸ”‹', 'ğŸ“', 'â˜ï¸',
  'ğŸ“Ÿ', 'ğŸ“ ', 'ğŸ””', 'ğŸ”•', 'ğŸµ',
  'ğŸ¶', 'ğŸ™ï¸', 'ğŸšï¸', 'ğŸ›ï¸', 'ğŸ“¢',
  'ğŸ“£', 'ğŸ“¯', 'ğŸ”Š', 'ğŸ”‰', 'ğŸ”ˆ',
  'ğŸ”‡', 'ğŸ¼', 'ğŸ¤', 'ğŸ§', 'ğŸ“»',
  // Objects - Medical & Science
  'ğŸ’‰', 'ğŸ©¸', 'ğŸ’Š', 'ğŸ©¹', 'ğŸ©¼',
  'ğŸ©º', 'ğŸ©»', 'ğŸ§¬', 'ğŸ¦ ', 'ğŸ§«',
  'ğŸ§ª', 'ğŸŒ¡ï¸', 'ğŸ”¬', 'ğŸ”­', 'ğŸ“¡',
  'âš—ï¸', 'ğŸ§²', 'ğŸª¬', 'âš°ï¸', 'ğŸª¦',
  'âš±ï¸', 'ğŸº', 'ğŸ§Š', 'ğŸ«§', 'ğŸª¸',
  // Objects - Misc
  'ğŸ‘‘', 'ğŸ’', 'ğŸ©', 'ğŸ‘“', 'ğŸ•¶ï¸',
  'ğŸ¥½', 'ğŸ¦º', 'ğŸ‘”', 'ğŸ‘•', 'ğŸ‘–',
  'ğŸ§£', 'ğŸ§¤', 'ğŸ§¥', 'ğŸ§¦', 'ğŸ‘—',
  'ğŸ‘˜', 'ğŸ¥»', 'ğŸ©±', 'ğŸ©²', 'ğŸ©³',
  'ğŸ‘™', 'ğŸ‘š', 'ğŸ‘›', 'ğŸ‘œ', 'ğŸ‘',
  'ğŸ›ï¸', 'ğŸ’', 'ğŸ©´', 'ğŸ‘', 'ğŸ‘Ÿ',
  'ğŸ¥¾', 'ğŸ¥¿', 'ğŸ‘ ', 'ğŸ‘¡', 'ğŸ©°',
  'ğŸ‘¢', 'ğŸ’¼', 'ğŸ‘’', 'ğŸ“', 'ğŸ§¢',
  'ğŸª–', 'â›‘ï¸', 'ğŸ“¿', 'ğŸ’„', 'ğŸ’',
  'ğŸ’…', 'ğŸ‘£', 'ğŸ¦´', 'ğŸ¦·', 'ğŸ‘€',
  'ğŸ‘ï¸', 'ğŸ‘…', 'ğŸ‘„', 'ğŸ«¦', 'ğŸ§ ',
  'ğŸ«€', 'ğŸ«', 'ğŸ¦¾', 'ğŸ¦¿', 'ğŸ‘ƒ',
  'ğŸ‘‚', 'ğŸ¦»', 'ğŸ¦¶', 'ğŸ¦µ', 'ğŸ’ª',
  'ğŸ™', 'âœï¸', 'ğŸ¤³', 'ğŸ’…', 'ğŸ–ï¸',
  'ğŸª­', 'ğŸª®', 'ğŸªˆ', 'ğŸª‡', 'ğŸ¥Š',
  'ğŸ¥‹', 'ğŸ¥…', 'â›³', 'â›¸ï¸', 'ğŸ£',
  'ğŸ¤¿', 'ğŸ½', 'ğŸ¿', 'ğŸ›·', 'ğŸ¥Œ',
]

function loadFromStorage(): Record<string, string> {
  try {
    const stored = localStorage.getItem(STORAGE_KEY)
    return stored ? JSON.parse(stored) : {}
  } catch {
    return {}
  }
}

function saveToStorage(data: Record<string, string>) {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
  } catch {
    // localStorage non disponible (ex: mode privÃ©)
  }
}

// State rÃ©actif partagÃ© entre tous les composants
const emojiMap = ref<Record<string, string>>(loadFromStorage())

export function useBucketEmojis() {
  function getKey(profileId: string, bucketName: string): string {
    return `${profileId}:${bucketName}`
  }

  function getEmoji(profileId: string, bucketName: string): string {
    return emojiMap.value[getKey(profileId, bucketName)] ?? DEFAULT_EMOJI
  }

  function setEmoji(profileId: string, bucketName: string, emoji: string): void {
    const key = getKey(profileId, bucketName)
    if (emoji === DEFAULT_EMOJI) {
      delete emojiMap.value[key]
    } else {
      emojiMap.value[key] = emoji
    }
    saveToStorage(emojiMap.value)
  }

  return {
    getEmoji,
    setEmoji,
    DEFAULT_EMOJI,
    BUCKET_EMOJIS,
    emojiMap,
  }
}
